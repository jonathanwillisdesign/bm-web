---
import Lottie from './Lottie.astro';

interface Props {
  type: 'image' | 'video' | 'lottie' | 'rive';
  src: string;
  alt?: string;
  caption?: string;
  layout?: 'full' | 'contained' | 'wide';
  aspectRatio?: string;
  loop?: boolean;
  autoplay?: boolean;
  class?: string;
}

const {
  type,
  src,
  alt = '',
  caption,
  layout = 'contained',
  aspectRatio,
  loop = true,
  autoplay = true,
  class: className
} = Astro.props;
---

<div class:list={['media-block', `media-block--${layout}`, className]}>
  <div class="media-block__container" style={aspectRatio ? `aspect-ratio: ${aspectRatio}` : undefined}>
    {type === 'image' && (
      <img
        src={src}
        alt={alt}
        class="media-block__image"
        loading="lazy"
      />
    )}

    {type === 'video' && (
      <video
        src={src}
        class="media-block__video"
        controls
        playsinline
      >
        <track kind="captions" />
        Your browser does not support the video tag.
      </video>
    )}

    {type === 'lottie' && (
      <Lottie
        src={src}
        loop={loop}
        autoplay={autoplay}
        class="media-block__lottie"
      />
    )}

    {type === 'rive' && (
      <canvas
        class="media-block__rive"
        data-rive-src={src}
      >
        <!-- Rive animation will be loaded here -->
      </canvas>
    )}
  </div>

  {caption && (
    <p class="media-block__caption body-small">{caption}</p>
  )}
</div>

<style>
  .media-block {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--content-gap-small);
  }

  .media-block--full {
    margin-left: calc(-1 * var(--page-margin));
    margin-right: calc(-1 * var(--page-margin));
    width: calc(100% + 2 * var(--page-margin));
  }

  .media-block--wide {
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }

  .media-block--contained {
    max-width: 100%;
  }

  .media-block__container {
    width: 100%;
    overflow: hidden;
    background-color: var(--surface-light);
    border-radius: var(--radius-medium);
    position: relative;
  }

  .media-block--full .media-block__container {
    border-radius: 0;
  }

  .media-block__image,
  .media-block__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .media-block__lottie {
    width: 100%;
    height: 100%;
  }

  .media-block__rive {
    width: 100%;
    height: 100%;
    display: block;
  }

  .media-block__caption {
    color: var(--text-alternative);
    text-align: center;
    padding: 0 var(--content-gap-small);
  }

  @media (max-width: 768px) {
    .media-block--wide {
      margin-left: calc(-1 * var(--page-margin));
      margin-right: calc(-1 * var(--page-margin));
      width: calc(100% + 2 * var(--page-margin));
    }
  }
</style>
