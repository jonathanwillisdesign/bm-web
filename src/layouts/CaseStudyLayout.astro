---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';
import Section from '../components/Section.astro';
import Button from '../components/Button.astro';
import CaseStudyCard from '../components/CaseStudyCard.astro';

interface Props {
  study: CollectionEntry<'case-studies'>;
  nextStudy: CollectionEntry<'case-studies'>;
  serviceMap: Map<string, string>;
}

const { study, nextStudy, serviceMap } = Astro.props;
const { Content } = await study.render();
---

<BaseLayout
  title={`${study.data.title} - Big Motive`}
  description={study.data.description}
>
  <!-- Hero Image -->
  {study.data.heroImage && (
    <div class="hero-image">
      <img src={study.data.heroImage} alt={study.data.title} />
    </div>
  )}

  <!-- Title Section -->
  <Section variant="alternative">
    <div class="case-study-header">
      <div class="header-content">
        {study.data.client && (
          <p class="body-xlarge client-name">{study.data.client}</p>
        )}
        <h1 class="heading-large">{study.data.title}</h1>
      </div>

      <div class="header-meta">
        <div class="services-meta">
          <p class="body-small-bold meta-label">Our focus</p>
          <div class="services-list">
            <p class="body-small service-item">Design Research</p>
            <p class="body-small service-item">Visual Communication</p>
            <p class="body-small service-item">Brand Strategy</p>
            <p class="body-small service-item">UX/UI Design</p>
            <p class="body-small service-item">Website Design</p>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Spacer -->
  <div class="spacer"></div>

  <!-- MDX Content -->
  <Section variant="standard">
    <article class="case-study-content">
      <Content />
    </article>
  </Section>

  <!-- Spacer -->
  <div class="spacer"></div>

  <!-- Next Case Study -->
  <Section variant="standard">
    <div class="next-case-study">
      <div class="next-header">
        <span class="body-large">Next project</span>
        <h2 class="heading-small">{nextStudy.data.title}</h2>
      </div>
      <CaseStudyCard
        title={nextStudy.data.title}
        client={nextStudy.data.client}
        description={nextStudy.data.description}
        category={nextStudy.data.services?.[0] ? (serviceMap.get(nextStudy.data.services[0]) || nextStudy.data.services[0]) : 'Project'}
        image={nextStudy.data.heroImage}
        href={`/work/${nextStudy.slug}`}
      />
    </div>
  </Section>
</BaseLayout>

<style>
  /* Hero Image */
  .hero-image {
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    background-color: var(--surface-light);
  }

  .hero-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Title Section */
  .case-study-header {
    display: grid;
    grid-template-columns: 1fr 240px;
    gap: var(--content-gap-large);
    width: 100%;
    align-items: start;
  }

  .header-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .client-name {
    color: var(--text-standard);
  }

  .header-meta {
    display: flex;
    flex-direction: column;
    gap: var(--content-gap-small);
    align-items: flex-start;
  }

  .services-meta {
    display: flex;
    flex-direction: column;
    gap: 0;
    width: 100%;
  }

  .meta-label {
    color: var(--text-standard);
    margin-bottom: 0;
  }

  .services-list {
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .service-item {
    color: #515050;
    margin: 0;
  }

  /* Spacer */
  .spacer {
    height: 80px;
    width: 100%;
    background-color: var(--surface-standard);
  }

  /* Content Area */
  .case-study-content {
    display: flex;
    flex-direction: column;
    gap: 80px;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Text blocks should have consistent spacing */
  .case-study-content :global(> *) {
    margin: 0;
  }

  .case-study-content :global(h2) {
    font-size: var(--body-large-size);
    font-weight: var(--body-large-bold-weight);
    line-height: var(--body-large-line-height);
    letter-spacing: var(--body-large-letter-spacing);
  }

  .case-study-content :global(h3) {
    font-size: var(--body-large-size);
    font-weight: var(--body-large-bold-weight);
    line-height: var(--body-large-line-height);
    letter-spacing: var(--body-large-letter-spacing);
  }

  .case-study-content :global(p) {
    font-size: var(--body-large-size);
    font-weight: var(--body-large-weight);
    line-height: var(--body-large-line-height);
    letter-spacing: var(--body-large-letter-spacing);
    max-width: 100%;
  }

  /* Text blocks wrapper */
  .case-study-content :global(.text-block) {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Next Case Study */
  .next-case-study {
    display: flex;
    flex-direction: column;
    gap: var(--content-gap-large);
    width: 100%;
  }

  .next-header {
    display: flex;
    flex-direction: column;
    gap: var(--content-gap-small);
  }

  .next-header .body-large {
    color: var(--text-alternative);
  }

  /* Footer CTA */
  .footer-cta {
    display: flex;
    flex-direction: column;
    gap: var(--content-gap-medium);
    align-items: center;
    text-align: center;
    padding: var(--content-gap-xlarge) 0;
  }

  .footer-cta .body-large {
    color: var(--text-alternative);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .case-study-header {
      grid-template-columns: 1fr;
      gap: var(--content-gap-medium);
    }

    .header-meta {
      width: 100%;
    }
  }

  @media (max-width: 768px) {
    .hero-image {
      max-height: 50vh;
    }

    .meta-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }
  }
</style>
